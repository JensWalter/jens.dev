<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>extracting information from websites through xslt &middot; </title>
        <meta name="description" content="Today, most websites feature some kind of feed, so every user who wants to stay in touch, can follow new publications very easily. Some sites support RSS-feeds or mail notification. Although this is pretty common, there are still sites out there who doesn’t. For that purpose I tried to find some easy solution.
First problem here is, how to get the information into some format usable. HTML is not meant for complex data mining operations.">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.99.1" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="extracting information from websites through xslt">
<meta property="og:description" content="Today, most websites feature some kind of feed, so every user who wants to stay in touch, can follow new publications very easily. Some sites support RSS-feeds or mail notification. Although this is pretty common, there are still sites out there who doesn’t. For that purpose I tried to find some easy solution.
First problem here is, how to get the information into some format usable. HTML is not meant for complex data mining operations.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jens.dev/2009/06/05/extracting-information-from-websites-through-xslt.html">
        <link rel="stylesheet" href="https://jens.dev/dist/site.css">
        <link rel="stylesheet" href="https://jens.dev/dist/syntax.css">
        <link rel="icon" type="image/png" href="/favicon.png">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
        
        
        

    </head>
    <body>
        
<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-5676095-8', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a href="https://jens.dev/">My personal blog</a>
                            </h1>
                        
                        
                            <a class="button-square" href="https://jens.dev/index.xml" aria-label="RSS"><i class="fa fa-rss" aria-hidden="true"></i></a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" aria-label="Twitter" href="https://twitter.com/jens_walter" rel="me" >
                                <i class="fa fa-twitter" aria-hidden="true"></i>
                            </a>
                        
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" aria-label="Github" href="https://github.com/JensWalter" rel="me">
                                <i class="fa fa-github-alt" aria-hidden="true"></i>
                            </a>
                        
                        
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a href="/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a href="/project.html">Projects</a>
    </li>


                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">extracting information from websites through xslt</h1>
    
    <p class="post-date post-line">
        <span>Published <time datetime="2009-06-05" itemprop="datePublished">Fri, Jun 5, 2009</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="#" itemprop="url" rel="author"></a>
            </span>
        </span>
    </p>
    
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>Today, most websites feature some kind of feed, so every user who wants to stay in touch, can follow new publications very easily. Some sites support RSS-feeds or mail notification. Although this is pretty common, there are still sites out there who doesn’t. For that purpose I tried to find some easy solution.</p>
<p>First problem here is, how to get the information into some format usable. HTML is not meant for complex data mining operations. So the first thing to look at would be to ignore the HTML part and do string analysis of the content. This can be really difficult, because you lose the structure of the site completely.</p>
<p>Another approach would be, to somehow utilize the DOM tree which the browser uses to obtain the data. One side Effect would be, that data mining could easily be done via DOM operations. But even for that solution I found no engine which provides DOM support for HTML pages which can be build into an application.</p>
<p>Keeping the DOM approach in mind I started to look around for XML solutions which can also parse HTML data (cause they are not so different from one another). So I came to the <a href="http://xmlsoft.org/">libXML</a> project. They implemented a open-source XML-parser which has also the ability to parse HTML. Although the HTML part is still a bit shaky, it looked quite promising. Now there was still the problem of how to retrieve the information. LibXML provides no DOM interface at all. One thing it does provide is XSLT support. Being an EAI developer this was a good compromise.</p>
<p>So here a little tutorial how to make this work in the shell.</p>
<p><strong>First choose your site.</strong></p>
<p>I choosed <a href="http://www.deraktionaer.de/xist4c/web/Online---Musterdepot_id_1261_.htm">this one</a> (from a german stocks magazine I subscribed) just out of curiousity and I also have to mention, this site already has e-mail notification (so there is no need to actually use this on that site).</p>
<p><strong>Second, get the XPath</strong> you want to extract. If you have knowledge of XPath this should be easy, if not use something like firebug to get there.</p>
<!-- raw HTML omitted -->
<p><strong>After that you can start on creating your XSL</strong> script for the transformation. The complete xslt should look something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;xsl:stylesheet</span> <span style="color:#75af00">xmlns:xsl=</span><span style="color:#d88200">&#34;http://www.w3.org/1999/XSL/Transform&#34;</span> <span style="color:#75af00">version=</span><span style="color:#d88200">&#34;1.0&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;xsl:output</span> <span style="color:#75af00">method=</span><span style="color:#d88200">&#34;text&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;xsl:template</span> <span style="color:#75af00">match=</span><span style="color:#d88200">&#34;/&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:apply-templates</span> <span style="color:#75af00">select=</span><span style="color:#d88200">&#34;*&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/xsl:template&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;xsl:template</span> <span style="color:#75af00">match=</span><span style="color:#d88200">&#34;*&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:apply-templates</span> <span style="color:#75af00">select=</span><span style="color:#d88200">&#34;*&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/xsl:template&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;xsl:template</span> <span style="color:#75af00">match=</span><span style="color:#d88200">&#39;//tr[@class=&#34;odd&#34; and string-length(td[@class=&#34;date&#34;])&gt;0]&#39;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:text&gt;</span>date: <span style="color:#f92672">&lt;/xsl:text&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:value-of</span> <span style="color:#75af00">select=</span><span style="color:#d88200">&#39;td[@class=&#34;date&#34;]&#39;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:text&gt;</span>,action: <span style="color:#f92672">&lt;/xsl:text&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:value-of</span> <span style="color:#75af00">select=</span><span style="color:#d88200">&#39;td[@class=&#34;action&#34;]&#39;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:text&gt;</span>,wkn: <span style="color:#f92672">&lt;/xsl:text&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:value-of</span> <span style="color:#75af00">select=</span><span style="color:#d88200">&#39;td[@class=&#34;wkn&#34;]&#39;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:text&gt;</span>,name: <span style="color:#f92672">&lt;/xsl:text&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:value-of</span> <span style="color:#75af00">select=</span><span style="color:#d88200">&#39;td[@class=&#34;name&#34;]/a&#39;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:text&gt;</span>,amount: <span style="color:#f92672">&lt;/xsl:text&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:value-of</span> <span style="color:#75af00">select=</span><span style="color:#d88200">&#39;td[@class=&#34;amount&#34;]&#39;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:text&gt;</span>,value: <span style="color:#f92672">&lt;/xsl:text&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:value-of</span> <span style="color:#75af00">select=</span><span style="color:#d88200">&#39;td[@class=&#34;value&#34;]&#39;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:text&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/xsl:text&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;xsl:apply-templates/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/xsl:template&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/xsl:stylesheet&gt;</span>
</span></span></code></pre></div><p>If you need more detail one XSLT you should check out <a href="http://www.w3schools.com/xsl/default.asp">w3schools</a>. They have some good tutorials for starters.</p>
<p>The important part of this XSLT is the last template section. This is actually the part you have to use to get to your information. First comes the template match. Here you have to insert the XPath you have obtained before. After that you have to select (via XPath) what information you want and formulate how you want this to be written out.</p>
<p><strong>Now you just have to put one and one together</strong> and you have your data mining solution.</p>
<p>I inserted the following bash script into my cron table and now have a subscription to this site.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s http://www.deraktionaer.de/xist4c/web/Online---Musterdepot_id_1261_.htm <span style="color:#111">|</span> sed -e <span style="color:#d88200">&#39;s/&amp;/&amp;/g&#39;</span> - <span style="color:#111">|</span> xsltproc -html online.xslt -
</span></span></code></pre></div><p>Now that you have the raw information it should be no problem to get this into some mailinglist oder database for future use.</p>
<p>PS: In case you wonder about the sed in the statement. As I already mentioned the libXML is not really the most flexible solution for parsing HTML. Especially when it comes to HTML codes like ©, libXML resigns with an error. To avoid this I transformed all ampersands to escaped ampersands.</p>

</div>

        <footer class="post-footer clearfix">
        <p class="post-tags">
            <span>Tagged:</span>
                <a href="/tags/html.html">HTML</a>, 
                <a href="/tags/xslt.html">XSLT</a>
        </p>
    <div class="share">
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a href="https://jens.dev/">My personal blog</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#" aria-label="Back to Top">
                        <i class="fa fa-angle-up" aria-hidden="true"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2022 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="https://jens.dev/js/jquery-1.11.3.min.js"></script>
        <script src="https://jens.dev/js/jquery.fitvids.js"></script>
        <script src="https://jens.dev/js/scripts.js"></script>
    </body>
</html>

