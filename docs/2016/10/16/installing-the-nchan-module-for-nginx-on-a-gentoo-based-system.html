<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>installing the nchan module for nginx on a gentoo based system &middot; </title>
        <meta name="description" content="I recently encountered a requirement that could be fulfilled by the nchan module for nginx. nchan does provide prebuilt packages for Archlinux, Debian, Ubuntu and Fedora. Sadly, there is nothing there for gentoo users. So I directly skipped ahead to the &ldquo;build from source&rdquo; section. The instructions where pretty basic:
 clone the github repo configure nginx with ./configure &ndash;add-module=path/to/nchan build  For me this lead to the following result:">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.80.0" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="installing the nchan module for nginx on a gentoo based system">
<meta property="og:description" content="I recently encountered a requirement that could be fulfilled by the nchan module for nginx. nchan does provide prebuilt packages for Archlinux, Debian, Ubuntu and Fedora. Sadly, there is nothing there for gentoo users. So I directly skipped ahead to the &ldquo;build from source&rdquo; section. The instructions where pretty basic:
 clone the github repo configure nginx with ./configure &ndash;add-module=path/to/nchan build  For me this lead to the following result:">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jens.dev/2016/10/16/installing-the-nchan-module-for-nginx-on-a-gentoo-based-system.html">
        <link rel="stylesheet" href="https://jens.dev/dist/site.css">
        <link rel="stylesheet" href="https://jens.dev/dist/syntax.css">
        <link rel="icon" type="image/png" href="/favicon.png">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
        
        
        

    </head>
    <body>
        
<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-5676095-8', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a href="https://jens.dev/">My personal blog</a>
                            </h1>
                        
                        
                            <a class="button-square" href="https://jens.dev/index.xml" aria-label="RSS"><i class="fa fa-rss" aria-hidden="true"></i></a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" aria-label="Twitter" href="https://twitter.com/jens_walter" rel="me" >
                                <i class="fa fa-twitter" aria-hidden="true"></i>
                            </a>
                        
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" aria-label="Github" href="https://github.com/JensWalter" rel="me">
                                <i class="fa fa-github-alt" aria-hidden="true"></i>
                            </a>
                        
                        
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a href="/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a href="/project.html">Projects</a>
    </li>


                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">installing the nchan module for nginx on a gentoo based system</h1>
    
    <p class="post-date post-line">
        <span>Published <time datetime="2016-10-16" itemprop="datePublished">Sun, Oct 16, 2016</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="#" itemprop="url" rel="author"></a>
            </span>
        </span>
    </p>
    
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>I recently encountered a requirement that could be fulfilled by the nchan module for nginx.
nchan does provide prebuilt packages for Archlinux, Debian, Ubuntu and Fedora. Sadly, there is nothing there for gentoo users. So I directly skipped ahead to the &ldquo;build from source&rdquo; section.
The instructions where pretty basic:</p>
<ul>
<li>clone the github repo</li>
<li>configure nginx with ./configure &ndash;add-module=path/to/nchan</li>
<li>build</li>
</ul>
<p>For me this lead to the following result:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#111">EXTRA_ECONF</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;--add-module==/tmp/nchan-1.0.3&#34;</span> emerge -avt nginx

<span style="color:#f92672">[</span>ebuild   R    <span style="color:#f92672">]</span> www-servers/nginx-1.10.1::gentoo  <span style="color:#111">USE</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http http-cache http2 ipv6 luajit pcre ssl -aio -debug -libatomic (-libressl) -pcre-jit -rtmp (-selinux) -threads -vim-syntax&#34;</span> <span style="color:#111">NGINX_MODULES_HTTP</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;auth_basic auth_request charset gunzip gzip gzip_static headers_more limit_conn limit_req lua proxy rewrite -access -addition -ajp -auth_ldap -auth_pam -autoindex -browser -cache_purge -dav -dav_ext -degradation -echo -empty_gif -fancyindex -fastcgi -flv -geo -geoip -image_filter -map -memc -memcached -metrics -mogilefs -mp4 -naxsi -perl -push_stream -random_index -realip -referer -scgi -secure_link -security -slice -slowfs_cache -spdy -split_clients -ssi -sticky -stub_status -sub -upload_progress -upstream_check -upstream_ip_hash -userid -uwsgi -xslt&#34;</span> <span style="color:#111">NGINX_MODULES_MAIL</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;-imap -pop3 -smtp&#34;</span> <span style="color:#111">NGINX_MODULES_STREAM</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;-access -limit_conn -upstream&#34;</span> <span style="color:#ae81ff">0</span> KiB

Total: <span style="color:#ae81ff">1</span> package <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> reinstall<span style="color:#f92672">)</span>, Size of downloads: <span style="color:#ae81ff">0</span> KiB
</code></pre></div><p>At first this looks fine, but it doesn&rsquo;t grab the module for whatever reason.</p>
<p>So looking for an alternative route, I found an overlay which packages nginx with nchan.
To set up the overlay I did the following.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#install layman as overlay manager</span>
emerge layman
<span style="color:#75715e">#add mva as overlay</span>
layman -a mva
<span style="color:#75715e">#add overlays to the make.conf</span>
<span style="color:#111">echo</span> <span style="color:#d88200">&#34;source /var/lib/layman/make.conf&#34;</span> &gt;&gt; /etc/portage/make.conf
</code></pre></div><p>After adding the overlay, I could simply emerge nginx and add the nchan module to the build settings.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">emerge -av www-servers/nginx::mva

<span style="color:#f92672">[</span>ebuild  NS   ~<span style="color:#f92672">]</span> www-servers/nginx-1.11.5:mainline::mva <span style="color:#f92672">[</span>1.10.1:0::gentoo<span style="color:#f92672">]</span> <span style="color:#111">USE</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http http-cache ipv6 luajit pam pcre ssl -aio -debug -http2 -libatomic -mail -pcre-jit -perftools -rrd (-selinux) -stream -threads -vim-syntax&#34;</span> <span style="color:#111">NGINX_MODULES_HTTP</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;auth_basic auth_request charset gunzip gzip gzip_static headers_more limit_conn limit_req lua nchan ndk proxy rewrite -access -addition -ajp -array_var -auth_ldap -auth_pam -autoindex -browser -cache_purge -coolkit -ctpp -dav -dav_ext -degradation -drizzle -echo -empty_gif -encrypted_session -enmemcache -ey_balancer -fancyindex -fastcgi -flv -form_input -geo -geoip -hls_audio -iconv -image_filter -lua_upstream -map -memc -memcached -metrics -mogilefs -mp4 -naxsi -njs -pagespeed -passenger -perl -postgres -push_stream -random_index -rds_csv -rds_json -realip -redis -referer -replace_filter -scgi -secure_link -security -set_misc -slice -slowfs_cache -split_clients -srcache -ssi -sticky -stub_status -sub -supervisord -tcpproxy -upload_progress -upstream_check -upstream_hash -upstream_ip_hash -upstream_keepalive -upstream_least_conn -upstream_zone -userid -uwsgi -v2 -xslt -xss&#34;</span> <span style="color:#111">NGINX_MODULES_MAIL</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;-imap -pop3 -smtp&#34;</span> <span style="color:#111">NGINX_MODULES_STREAM</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;-access -geo -geoip -limit_conn -lua -map -return -split_clients -upstream_hash -upstream_least_conn -upstream_zone&#34;</span> <span style="color:#111">RUBY_TARGETS</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;ruby20 ruby21 (-jruby) -ruby22 -ruby23&#34;</span> <span style="color:#ae81ff">2141</span> KiB
<span style="color:#f92672">[</span>uninstall     <span style="color:#f92672">]</span> www-servers/nginx-1.10.1::gentoo  <span style="color:#111">USE</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http http-cache http2 ipv6 luajit pcre ssl -aio -debug -libatomic (-libressl) -pcre-jit -rtmp (-selinux) -threads -vim-syntax&#34;</span> <span style="color:#111">NGINX_MODULES_HTTP</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;auth_basic auth_request charset gunzip gzip gzip_static headers_more limit_conn limit_req lua proxy rewrite -access -addition -ajp -auth_ldap -auth_pam -autoindex -browser -cache_purge -dav -dav_ext -degradation -echo -empty_gif -fancyindex -fastcgi -flv -geo -geoip -image_filter -map -memc -memcached -metrics -mogilefs -mp4 -naxsi -perl -push_stream -random_index -realip -referer -scgi -secure_link -security -slice -slowfs_cache -spdy -split_clients -ssi -sticky -stub_status -sub -upload_progress -upstream_check -upstream_ip_hash -userid -uwsgi -xslt&#34;</span> <span style="color:#111">NGINX_MODULES_MAIL</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;-imap -pop3 -smtp&#34;</span> <span style="color:#111">NGINX_MODULES_STREAM</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;-access -limit_conn -upstream&#34;</span>
</code></pre></div><p>Now you can see, that the overlay is packed with third party modules, including the nchan module.</p>

</div>

        <footer class="post-footer clearfix">
        <p class="post-tags">
            <span>Tagged:</span>
                <a href="/tags/nginx.html">nginx</a>
        </p>
    <div class="share">
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a href="https://jens.dev/">My personal blog</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#" aria-label="Back to Top">
                        <i class="fa fa-angle-up" aria-hidden="true"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2021 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="https://jens.dev/js/jquery-1.11.3.min.js"></script>
        <script src="https://jens.dev/js/jquery.fitvids.js"></script>
        <script src="https://jens.dev/js/scripts.js"></script>
    </body>
</html>

